# Stage 2: Enhanced Configuration
# Multiple analysts, intelligence fusion, PostgreSQL persistence

stage: stage2

trading:
  pairs:
    - BTC/USDT
    - ETH/USDT
    - SOL/USDT
  quote_currency: USDT
  initial_capital: 1000.0
  target_capital: 5000.0
  check_interval_minutes: 30  # More frequent checks

risk:
  max_position_pct: 0.20
  max_total_exposure_pct: 0.80
  stop_loss_pct: 0.05  # Fallback when volatility calculation fails
  min_confidence: 0.65  # Slightly lower with more signals
  max_daily_trades: 15
  max_daily_loss_pct: 0.10

# Volatility-Based Risk Configuration
volatility_risk:
  enabled: true  # Enable volatility-aware stop-losses and take-profits
  atr_period: 14  # ATR calculation period (standard is 14)
  volatility_lookback: 20  # Candles to look back for volatility analysis
  
  # ATR multipliers for stop-loss calculation
  base_stop_multiplier: 2.0  # Base ATR multiplier for stop-loss
  low_vol_stop_multiplier: 1.5    # BTC, ETH - tighter stops
  medium_vol_stop_multiplier: 2.0  # Default multiplier
  high_vol_stop_multiplier: 2.5   # SOL, meme coins - wider stops
  
  # ATR multipliers for take-profit calculation  
  base_tp_multiplier: 3.0  # Base ATR multiplier for take-profit
  low_vol_tp_multiplier: 2.0      # Conservative targets for stable assets
  medium_vol_tp_multiplier: 3.0   # Standard targets
  high_vol_tp_multiplier: 4.0     # Aggressive targets for volatile assets
  
  # Volatility classification thresholds (ATR as % of price)
  low_volatility_threshold: 0.02   # 2% - anything below is "low vol"
  high_volatility_threshold: 0.06  # 6% - anything above is "high vol"
  
  # Fallback values when volatility data is unavailable
  fallback_stop_loss_pct: 0.05    # 5% fallback stop-loss
  fallback_take_profit_pct: 0.10  # 10% fallback take-profit
  
  # Data quality requirements
  min_candles_required: 14  # Minimum candles needed for volatility calculation
  cache_ttl_minutes: 30     # How long to cache volatility profiles

features:
  # Analysts
  enable_technical_analyst: true
  enable_sentiment_analyst: true   # NEW: News/social sentiment
  enable_onchain_analyst: false
  enable_macro_analyst: false

  # Intelligence
  enable_intel_fusion: true        # NEW: Combine analyst signals
  enable_regime_detection: false

  # Strategy  
  enable_advanced_strategies: true  # NEW: Advanced strategist with volatility-aware risk

  # Execution
  enable_limit_orders: true        # NEW: Better fills
  enable_smart_routing: false

  # Risk
  enable_circuit_breakers: true    # NEW: Daily loss limits
  enable_anomaly_detection: false

  # Memory
  enable_postgres: true            # NEW: Persistent storage
  enable_learning: false

  # Other
  enable_event_bus: true           # NEW: Event-driven comms
  simulation_mode: true  # Start with simulation for testing

# Database Configuration
database:
  url: ${DATABASE_URL:-postgresql://trader:trader@localhost:5432/trader}
  pool_min: 2
  pool_max: 10
  command_timeout: 60

# Redis Configuration
redis:
  url: ${REDIS_URL:-redis://localhost:6379}
  cache_ttl_seconds: 300  # 5 minutes default TTL
  market_data_ttl: 60  # 1 minute for market data
  sentiment_ttl: 900  # 15 minutes for sentiment data

# Sentiment Analysis Configuration
sentiment:
  fear_greed_weight: 0.5
  news_weight: 0.4
  social_weight: 0.1
  cache_ttl_minutes: 15
  news_lookback_hours: 24
  news_headline_limit: 10

# Intelligence Fusion Weights
fusion:
  analyst_weights:
    technical: 0.45
    sentiment: 0.35
    onchain: 0.15
    macro: 0.05

# Circuit Breaker Thresholds
circuit_breakers:
  max_daily_loss_pct: 0.10
  max_daily_trades: 15
  volatility_threshold_pct: 0.10
  consecutive_loss_limit: 3

# Limit Order Configuration
limit_orders:
  enabled: true
  timeout_seconds: 60
  spread_buffer_pct: 0.001  # 0.1% inside spread
  fallback_to_market: true

log_level: INFO
